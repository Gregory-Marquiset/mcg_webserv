<!-- <!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<title>MCG Webserv login</title>
		<link rel="stylesheet" href="css/style.css">
		<script src="js/theme.js" defer></script>
		<script src="js/signup.js" defer></script>
	</head>
	<body>
		<div class="fixed-top-buttons-left">
			<button onclick="toggleTheme()" title="Changer de th√®me">üé®</button>
			<a href="../../index.html" title="Accueil">üè†</a>
		</div>
		
		<h1>Login page</h1>
		<div class="section">
			<h2>Cr√©er un compte</h2>
			<form id="signupForm" method="POST" action="/signup">
				<label for="username">Nom d'utilisateur :</label>
				<input type="text" id="username" name="username" required />
		
				<label for="email">Adresse e-mail :</label>
				<input type="email" id="email" name="email" required />
		
				<label for="password">Mot de passe :</label>
				<input type="password" id="password" name="password" required minlength="6" />
		
				<label for="confirmPassword">Confirmer le mot de passe :</label>
				<input type="password" id="confirmPassword" name="confirmPassword" required minlength="6" />
		
				<p id="error" style="color:red; display:none;"></p>
		
				<button type="submit">Cr√©er mon compte</button>
			</form>
		</div>
	</body>
</html> -->
<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<title>MCG Webserv login</title>
	<link rel="stylesheet" href="css/style.css">
	<script src="js/theme.js" defer></script>
	<script src="js/signup.js" defer></script>
</head>
<body>
	<div class="fixed-top-buttons-left">
		<button onclick="toggleTheme()" title="Changer de th√®me">üé®</button>
		<a href="../../index.html" title="Accueil">üè†</a>
	</div>

	<h1>Login page</h1>
	<div class="section">
		<h2>Cr√©er un compte</h2>
		<form id="signupForm">
			<label for="username">Nom d'utilisateur :</label>
			<input type="text" id="username" name="username" required />

			<label for="email">Adresse e-mail :</label>
			<input type="email" id="email" name="email" required />

			<label for="password">Mot de passe :</label>
			<input type="password" id="password" name="password" required minlength="6" />

			<label for="confirmPassword">Confirmer le mot de passe :</label>
			<input type="password" id="confirmPassword" name="confirmPassword" required minlength="6" />

			<p id="error" style="color:red; display:none;"></p>

			<button type="submit">Cr√©er mon compte</button>
		</form>
	</div>

	<script>
	document.addEventListener("DOMContentLoaded", () => {
		const form = document.getElementById("signupForm");
		form.addEventListener("submit", async function (e) {
			e.preventDefault();

			const username = document.getElementById("username").value;
			const email = document.getElementById("email").value;
			const password = document.getElementById("password").value;
			const confirmPassword = document.getElementById("confirmPassword").value;
			const error = document.getElementById("error");

			if (password !== confirmPassword) {
				error.textContent = "Les mots de passe ne correspondent pas.";
				error.style.display = "block";
				return;
			}
			if (password.length < 6) {
				error.textContent = "Le mot de passe doit contenir au moins 6 caract√®res.";
				error.style.display = "block";
				return;
			}
			error.style.display = "none";

			const sessionID = getCookieValue("sessionID");
			if (!sessionID) {
				error.textContent = "Session non trouv√©e.";
				error.style.display = "block";
				return;
			}

			const formData = new URLSearchParams();
			formData.append("sessionID", sessionID);
			formData.append("username", username);
			formData.append("email", email);
			formData.append("password", password);

			const response = await fetch("/cgi_tester/signup.cgi", {
				method: "POST",
				headers: { "Content-Type": "application/x-www-form-urlencoded" },
				body: formData.toString(),
			});

			const text = await response.text();
			if (response.ok) {
				alert("Compte cr√©√© avec succ√®s !");
				window.location.href = "index.html";
			} else {
				error.textContent = "Erreur lors de la cr√©ation du compte : " + text;
				error.style.display = "block";
			}
		});
	});
	</script>
</body>
</html>
