<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<title>Webserv Testeur</title>
	<link rel="stylesheet" href="../css/style.css">
	<script src="../js/theme.js" defer></script>
</head>
<body>

	<div class="fixed-top-buttons">
		<button onclick="toggleTheme()" title="Changer de th√®me">üé®</button>
		<a href="/login.html" title="Se connecter">üîê</a>
		<a href="/index.html" title="Home">üè†</a>
	</div>

	<h1>Webserv Testeur</h1>

	<!-- Requ√™te Personnalis√©e -->
	<div class="section">
		<h2>Envoyer une requ√™te HTTP</h2>
		<form id="httpForm">
			<label>URL relative :</label>
			<input type="text" id="url" value="/" required />

			<label>M√©thode :</label>
			<select id="method">
				<option>GET</option>
				<option>POST</option>
				<option>DELETE</option>
			</select>

			<label>Corps (pour POST) :</label>
			<textarea id="body" rows="4"></textarea>

			<button type="submit">Envoyer</button>
		</form>
		<div id="result"></div>
	</div>

	<!-- Boutons CGI -->
	<div class="section">
		<h2>Test de CGI</h2>
		<button onclick="sendRequest('/cgi-bin/test.py')">CGI Python</button>
		<button onclick="sendRequest('/cgi-bin/test.php')">CGI PHP</button>
		<button onclick="sendRequest('/cgi-bin/test.pl')">CGI Perl</button>
	</div>

	<!-- Simulation d'erreurs -->
	<div class="section">
		<h2>Erreurs HTTP</h2>
		<button onclick="sendRequest('/notfound')">404 Not Found</button>
		<button onclick="sendRequest('/forbidden')">403 Forbidden</button>
		<button onclick="sendRequest('/server-error')">500 Internal Server Error</button>
	</div>

	<!-- Session et cookies -->
	<div class="section">
		<h2>Cookies / Session</h2>
		<button onclick="showCookies()">Afficher les cookies</button>
		<div id="cookies"></div>
	</div>

	<!-- Upload fichier -->
	<div class="section">
		<h2>Upload de Fichier</h2>
		<form id="uploadForm">
			<input type="file" id="fileInput" name="file">
			<button type="submit">Envoyer fichier (POST)</button>
		</form>
	</div>

	<!-- Logs -->
	<div class="section">
		<h2>Logs de requ√™te/r√©ponse</h2>
		<div id="log"></div>
	</div>

	<script>
		async function sendRequest(url, method = 'GET', body = null) {
			const response = await fetch(url, {
				method: method,
				headers: { 'Content-Type': 'text/plain' },
				body: method === 'POST' ? body : null
			});
			const text = await response.text();
			document.getElementById('result').innerText = `Status: ${response.status} ${response.statusText}\n\n${text}`;
			document.getElementById('log').innerText = JSON.stringify({
				url: url,
				method: method,
				status: response.status,
				headers: Object.fromEntries(response.headers.entries())
			}, null, 2);
		}

		document.getElementById("httpForm").addEventListener("submit", async (e) => {
			e.preventDefault();
			const url = document.getElementById("url").value;
			const method = document.getElementById("method").value;
			const body = document.getElementById("body").value;
			sendRequest(url, method, body);
		});

		document.getElementById("uploadForm").addEventListener("submit", async (e) => {
			e.preventDefault();
			const fileInput = document.getElementById("fileInput");
			const formData = new FormData();
			formData.append("file", fileInput.files[0]);

			const response = await fetch("/upload", {
				method: "POST",
				body: formData
			});

			const text = await response.text();
			document.getElementById('result').innerText = `Status: ${response.status} ${response.statusText}\n\n${text}`;
		});

		function showCookies() {
			document.getElementById('cookies').innerText = document.cookie || 'Aucun cookie';
		}
	</script>
</body>
</html>
